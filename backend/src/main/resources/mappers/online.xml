<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="online">

	<insert id="insert">
		insert into 
			online (user_id, title, content, date 
				<if test='link != "null"'>
				, link
				</if>
				<if test='thumbnailSrc != "null"'>
				, thumbnail_src
				</if>
				<if test='video != "null"'>
				, video
				</if>
			 )
		values
			(#{userId}, #{title}, #{content}, #{date}
				<if test='link != "null"'>
				, #{link}
				</if>
				<if test='thumbnailSrc != "null"'>
				, #{thumbnailSrc}
				</if>
				<if test='video != "null"'>
				, #{video}
				</if>
			)
	</insert>
	
	<update id="update">
		update 
			meet
		set
			title=#{title}, content=#{content}, date=#{date}
			<if test='link != "null"'>
			, link = #{link}
			</if>
			<if test='thumbnailSrc != "null"'>
			,  thunmbnail_src = #{thumbnailSrc}
			</if>
			<if test='video != "null"'>
			,video =  #{video}
			</if>
		where
			online_id = #{onlineId}
	</update>

	<select id="selectAll" resultType="OnlineDto">
		select 
			online_id as onlineId, user_id as userId, title, content, date,
			 thumbnail_src as thumbnailSrc, link, video 
		FROM
			online
		order by online_id desc
		LIMIT #{startIndex}, 6
	</select>
	
	
	
	
	
	
	
	
	<select id="selectMeet" resultType="MeetViewResponseDto">
		select 
			meet_id as meetId, user_id as userId, nickname as writerNickname, recipe_id as recipeId,
			thumbnail_src as thumbnailSrc, type, join_limit as joinLimit, price, 
			title, content, date, address, lat, lng
		FROM meet join user using(user_id) 
		where meet_id = #{meetId}
	</select>
	
	<select id="selectMeetJoinList" resultType="MeetJoinDto">
		select 
			meet_join_id as meetJoinId, meet_id as meetId, user_id as userId, nickname
		FROM
			meet_join join user using(user_id)
		where meet_id = #{meetId}
	</select>
	
	<delete id="delete">
		delete from meet where meet_id = #{meetId}
	</delete>
	
	<select id="selectMeetByUserid" resultType="MeetDto">
		select 
			meet_id as meetId, user_id as userId, thumbnail_src as thumbnailSrc, type, join_limit as joinLimit, price, title
		FROM
			meet
		where
			user_id = #{userId}
		order by meet_id desc
	</select>
	
	<select id="selectMeetByType" resultType="MeetDto">
		select 
			meet_id as meetId, user_id as userId, 
			thumbnail_src as thumbnailSrc, type, 
			join_limit as joinLimit, price, title
		FROM
			meet
		where
			type = #{type}
		order by meet_id desc
	</select>
	
	<select id="selectMeetJoinByUserid" resultType="MeetDto">
		select 
			m.meet_id as meetId, m.user_id as userId, m.thumbnail_src as thumbnailSrc, type, m.join_limit as joinLimit, price, title
		FROM
			meet_join mj join meet m on mj.meet_id = m.meet_id
		where
			mj.user_id = #{userId}
		order BY m.meet_id desc
	</select>
	
	
	
	
	<insert id="insertMeetJoin">
		insert into 
			meet_join (meet_id, user_id)
		values 
			(#{meetId}, #{userId})
	</insert>
	
	<delete id="deleteMeetJoin">
		delete from meet_join where meet_join_id = #{meetJoinId}
	</delete>
</mapper>
