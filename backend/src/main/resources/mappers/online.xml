<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="online">

	<insert id="insert">
		insert into 
			online (user_id, title, content, date ,type
				<if test='link != "null"'>
				, link
				</if>
				<if test='thumbnailSrc != "null"'>
				, thumbnail_src
				</if>
				<if test='video != "null"'>
				, video
				</if>
			 )
		values
			(#{userId}, #{title}, #{content}, #{date}, #{type}
				<if test='link != "null"'>
				, #{link}
				</if>
				<if test='thumbnailSrc != "null"'>
				, #{thumbnailSrc}
				</if>
				<if test='video != "null"'>
				, #{video}
				</if>
			)
	</insert>
	
	<update id="update">
		update 
			meet
		set
			title=#{title}, content=#{content}, date=#{date}, type=#{type}
			<if test='link != "null"'>
			, link = #{link}
			</if>
			<if test='thumbnailSrc != "null"'>
			,  thunmbnail_src = #{thumbnailSrc}
			</if>
			<if test='video != "null"'>
			,video =  #{video}
			</if>
		where
			online_id = #{onlineId}
	</update>

	<select id="selectAll" resultType="OnlineDto">
		select 
			online_id as onlineId, user_id as userId, title, content, date, type
			 thumbnail_src as thumbnailSrc, link, video 
		FROM
			online
		order by online_id desc
		LIMIT #{startIndex}, 6
	</select>
	
	
	<select id="selectOnline" resultType="OnlineDto">
		select 
			online_id as onlineId, user_id as userId, title,content, type, date,
			link, thumbnail_src as thumbnailSrc, video
		from 
			online 
		where 
			online_id = #{onlineId}
	</select>
	
	<delete id="delete">
		delete from online where meet_id = #{onlineId}
	</delete>
	
	
	
	
	<select id="selectOnlineByUserid" resultType="OnlineDto">
		select 
			online_id as onlineId, user_id as userId, title,content, type, date,
			link, thumbnail_src as thumbnailSrc, video
		from
			online
		where
			user_id = #{userId}
		order by 
			online_id desc
	</select>
	
	<select id="selectOnlineByType" resultType="OnlineDto">
		select 
			online_id as onlineId, user_id as userId, title,content, type, date,
			link, thumbnail_src as thumbnailSrc, video
		FROM
			online
		where
			type = #{type}
		order by 
			online_id desc
	</select>
	
	<!-- <select id="selectMeetJoinByUserid" resultType="MeetDto">
		select 
			m.meet_id as meetId, m.user_id as userId, m.thumbnail_src as thumbnailSrc, type, m.join_limit as joinLimit, price, title
		FROM
			meet_join mj join meet m on mj.meet_id = m.meet_id
		where
			mj.user_id = #{userId}
		order BY m.meet_id desc
	</select> -->
	
	
	
	
	<insert id="insertOnlineJoin">
		insert into 
			meet_join (online_id, user_id)
		values 
			(#{onlineId}, #{userId})
	</insert>
	
	<delete id="deleteMeetJoin">
		delete from 
			meet_join 
		where 
			online_id = #{onlineId} and user_id =#{userId}
	</delete>
</mapper>
